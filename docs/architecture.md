## 框架介绍

![image-20230331223801343](https://s2.loli.net/2023/04/03/kOstofQECU7nIS9.png)

以上是预训练框架，首先使用自注意力机制将三维数据映射为二维，然后将所有数据拼接在一起，再进行交叉注意力机制将所有数据压缩为二维，加入位置编码后，通过基于预测时间的 MLP 直接输入到 Transformer 中，最终进入 Predict 层计算所有输入变量的预测值。最后根据预测的时间计算损失函数，整个流程简单而直接。

具体来说，该模型会随机生成一个预测时间 `t`，其中 `t`属于 $ \mathcal{U}[6, 168] $ ，然后根据此变量计算结果和损失。

#### 损失函数

![image-20230331224728678](https://s2.loli.net/2023/04/03/6IleNXoqsCpG7QW.png)

损失函数使用加权均方误差计算方法，其中加权平均值很直观。


### Finetuning

![image-20230331225523319](https://s2.loli.net/2023/03/31/KtcwpmMZu9OA1XL.png)

对于使用以上方法进行预训练的模型，微调很简单，分为两种情况。第一种情况是，如果预训练集包括该元素，则可以直接在训练集上进行微调。第二种情况是，需要更换 Header 和 Prediction，然后决定是否冻结预训练的参数进行微调，还可以添加一个 Neck 层来适应历史数据。





::: climax.arch
